{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\itsme.000\\\\OneDrive\\\\Skrivbord\\\\Nyheter-main\\\\client\\\\src\\\\views\\\\Login\\\\Login.jsx\",\n    _s = $RefreshSig$();\n\nimport { Link, useNavigate } from 'react-router-dom';\nimport styles from './Login.module.css';\nimport { useRef, useEffect } from 'react';\nimport { GoogleLogin } from 'react-google-login';\nimport { gapi } from 'gapi-script';\nimport { useDispatch, useSelector } from 'react-redux'; // import FacebookLoginComponent from './facebookLoginComponent';\n\nimport Header from '../../components/Header/Header';\nimport Profile from '../../components/Profile/Profile';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst {\n  loginWithEmail,\n  updateAccount,\n  getAccountWithToken\n} = require('../../dbUtils/accountActions');\n/* göm med env */\n\n\nconst clientId = process.env.REACT_APP_GOOGLE_LOGIN;\nexport default function Login() {\n  _s();\n\n  const stateUser = useSelector(state => state.User);\n  const dispatch = useDispatch();\n  const navigate = useNavigate(); //keep reference to inputs in HTML.\n\n  const emailInput = useRef('');\n  const passwordInput = useRef(''); //save token from login in sessionStorage\n\n  function saveToken(account) {\n    sessionStorage.setItem('token', account.token);\n    const accountToken = {\n      id: account._id,\n      token: account.token\n    };\n    updateAccount(accountToken);\n  } //Login in user\n\n\n  async function loginAuth(loginWithProvider) {\n    let account = {\n      email: emailInput.current.value,\n      password: passwordInput.current.value\n    }; //   function validateEmail(email)\n    //   {\n    //       let re = /\\S+@\\S+\\.\\S+/;\n    //       return re.test(email);\n    //   }\n    // if (!validateEmail(account.email)){\n    //     alert(\"Ej giltig email\")\n    //   return\n    //   }\n\n    if (loginWithProvider) {\n      account = loginWithProvider;\n    }\n\n    const accountInfo = await loginWithEmail(account);\n    saveToken(accountInfo);\n\n    if (accountInfo !== null && accountInfo !== void 0 && accountInfo.email) {\n      dispatch({\n        type: \"setUser\",\n        data: accountInfo\n      });\n\n      if ((accountInfo === null || accountInfo === void 0 ? void 0 : accountInfo.role) === \"admin\") {\n        // eslint-disable-next-line no-restricted-globals\n        if (confirm(\"Admin logged in, redirect to admin page?\")) {\n          navigate('/admin');\n        }\n\n        ;\n      }\n\n      ;\n    } else {\n      alert(accountInfo);\n    }\n  }\n\n  useEffect(() => {\n    const initClient = () => {\n      gapi.client.init({\n        clientId: clientId,\n        scope: ''\n      });\n    };\n\n    gapi.load('client:auth2', initClient);\n  }, []);\n\n  const onGoogleSuccess = res => {\n    const profile = {\n      email: res.profileObj.email,\n      name: res.profileObj.name,\n      signInPlatform: \"google\"\n    }; // eslint-disable-next-line no-restricted-globals\n\n    if (confirm(\"Vill du Automatiskt logga in med Google?\")) {\n      loginAuth(profile);\n    }\n  };\n\n  function linkToHomepage() {\n    navigate('/');\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: styles.loginContainer,\n    children: [/*#__PURE__*/_jsxDEV(Header, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 5\n    }, this), \" \", stateUser.email ? /*#__PURE__*/_jsxDEV(Profile, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 12\n    }, this) : /*#__PURE__*/_jsxDEV(\"section\", {\n      className: styles.loginForm,\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Logga in\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"uname\",\n        children: \"Email\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        ref: emailInput,\n        placeholder: \"Email\",\n        name: \"uname\",\n        autoComplete: \"on\",\n        required: \"required\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"psw\",\n        children: \"L\\xF6senord\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"password\",\n        ref: passwordInput,\n        placeholder: \"L\\xF6senord\",\n        name: \"pwd\",\n        required: \"required\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => {\n          loginAuth();\n        },\n        children: \"Logga in\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 112,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Link, {\n        to: \"/glomtlosenord\",\n        children: \"Gl\\xF6mt L\\xF6senord?\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: styles.brContainer,\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          className: styles.brTitle,\n          children: \"Alternativt:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 119,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(GoogleLogin, {\n        clientId: clientId,\n        buttonText: \"Sign in with Google\",\n        onSuccess: onGoogleSuccess,\n        onFailure: err => {\n          console.error(\"Error sign in with Google\");\n        },\n        cookiePolicy: 'single_host_origin',\n        isSignedIn: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Link, {\n        to: \"/prenumerera\",\n        children: \"Bli Prenumerant\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 12\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 100,\n    columnNumber: 11\n  }, this);\n}\n\n_s(Login, \"EIeIy+YaZ/84M9dAMuJYeCr/jgg=\", false, function () {\n  return [useSelector, useDispatch, useNavigate];\n});\n\n_c = Login;\n\nvar _c;\n\n$RefreshReg$(_c, \"Login\");","map":{"version":3,"names":["Link","useNavigate","styles","useRef","useEffect","GoogleLogin","gapi","useDispatch","useSelector","Header","Profile","loginWithEmail","updateAccount","getAccountWithToken","require","clientId","process","env","REACT_APP_GOOGLE_LOGIN","Login","stateUser","state","User","dispatch","navigate","emailInput","passwordInput","saveToken","account","sessionStorage","setItem","token","accountToken","id","_id","loginAuth","loginWithProvider","email","current","value","password","accountInfo","type","data","role","confirm","alert","initClient","client","init","scope","load","onGoogleSuccess","res","profile","profileObj","name","signInPlatform","linkToHomepage","loginContainer","loginForm","brContainer","brTitle","err","console","error"],"sources":["C:/Users/itsme.000/OneDrive/Skrivbord/Nyheter-main/client/src/views/Login/Login.jsx"],"sourcesContent":["import {Link, useNavigate} from 'react-router-dom'\nimport styles from './Login.module.css'\nimport {useRef, useEffect} from 'react'\nimport {GoogleLogin} from 'react-google-login';\nimport {gapi} from 'gapi-script';\nimport {useDispatch, useSelector} from 'react-redux'\n// import FacebookLoginComponent from './facebookLoginComponent';\n\nimport Header from '../../components/Header/Header';\nimport Profile from '../../components/Profile/Profile';\n\nconst {loginWithEmail, updateAccount, getAccountWithToken} = require('../../dbUtils/accountActions')\n/* göm med env */\nconst clientId = process.env.REACT_APP_GOOGLE_LOGIN;\n\nexport default function Login() {\n  const stateUser = useSelector(state => state.User)\n  const dispatch = useDispatch();\n  const navigate = useNavigate();\n\n  //keep reference to inputs in HTML.\n  const emailInput = useRef('');\n  const passwordInput = useRef('');\n\n  //save token from login in sessionStorage\n  function saveToken(account) {\n    sessionStorage.setItem('token', account.token);\n    const accountToken = {\n      id: account._id,\n      token: account.token\n    }\n    updateAccount(accountToken);\n  }\n\n  //Login in user\n  async function loginAuth(loginWithProvider) {\n    let account = {\n      email: emailInput.current.value,\n      password: passwordInput.current.value\n    }\n    //   function validateEmail(email)\n    //   {\n    //       let re = /\\S+@\\S+\\.\\S+/;\n    //       return re.test(email);\n    //   }\n    // if (!validateEmail(account.email)){\n    //     alert(\"Ej giltig email\")\n    //   return\n    //   }\n    \n    if (loginWithProvider) {\n      account = loginWithProvider;\n    }\n\n    const accountInfo = await loginWithEmail(account);\n    saveToken(accountInfo)\n\n    if (\n      accountInfo\n      ?.email) {\n      dispatch({type: \"setUser\", data: accountInfo});\n\n      if (\n        accountInfo\n        ?.role === \"admin\") {\n        // eslint-disable-next-line no-restricted-globals\n        if (confirm(\"Admin logged in, redirect to admin page?\")) {\n          navigate('/admin');\n        };\n      };\n    } else {\n      alert(accountInfo)\n    }\n  }\n\n  useEffect(() => {\n    const initClient = () => {\n      gapi.client.init({clientId: clientId, scope: ''});\n    };\n    gapi.load('client:auth2', initClient);\n  }, []);\n\n  const onGoogleSuccess = (res) => {\n    const profile = {\n      email: res.profileObj.email,\n      name: res.profileObj.name,\n      signInPlatform: \"google\"\n    }\n\n    // eslint-disable-next-line no-restricted-globals\n    if(confirm(\"Vill du Automatiskt logga in med Google?\")) {\n      loginAuth(profile)\n    }\n  };\n\n  function linkToHomepage() {\n    navigate('/')\n  }\n\n  return (<div className={styles.loginContainer}>\n    <Header/> {\n      stateUser.email\n        ? (<Profile/>)\n        : (<section className={styles.loginForm}>\n          <h2>Logga in</h2>\n          <label htmlFor='uname'>Email</label>\n          <input type='text' ref={emailInput} placeholder='Email' name='uname' autoComplete='on' required=\"required\"></input>\n\n          <label htmlFor='psw'>Lösenord</label>\n          <input type='password' ref={passwordInput} placeholder='Lösenord' name='pwd' required=\"required\"></input>\n\n          <button onClick={() => {\n              loginAuth()\n            }}>Logga in</button>\n\n          <Link to=\"/glomtlosenord\">Glömt Lösenord?</Link>\n\n          <div className={styles.brContainer}>\n            <span className={styles.brTitle}>\n              Alternativt:\n            </span>\n          </div>\n\n          <GoogleLogin clientId={clientId} buttonText=\"Sign in with Google\" onSuccess={onGoogleSuccess} onFailure={(err) => {\n            console.error(\"Error sign in with Google\")\n          }} cookiePolicy={'single_host_origin'} isSignedIn={true}/> \n          {/* <FacebookLoginComponent/> */}\n\n          <Link to=\"/prenumerera\">Bli Prenumerant</Link>\n        </section>)\n    }\n  </div>)\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}